define(['jquery'],function($){const KEYCODES={"left":37,"right":39,"up":38,"down":40,"escape":27,"tab":9};var options={submenuSelector:'ul',navSelector:'.has-nav',focusClass:'focus'};function Plugin(element,opts){this.element=element;this.options=$.extend(options,opts);this.init();}
Plugin.prototype.init=function(){var el=$(this.element);var links=$('a',el);var opts=this.options;var getFocusIndex=function(direction,focusedIndex){if(direction=="left"){for(var i=(focusedIndex-1);i>=0;i--){if(links.eq(i).is(':visible')){return i;break;}}}else{for(var i=(focusedIndex+1);i<links.length;i++){if(links.eq(i).is(':visible')){return i;break;}}}};var removeFocus=function(elements){if(!elements){var elements=el.find('.'+opts.focusClass);}
elements.removeClass(opts.focusClass);};var setAriaState=function(elements){if(!elements){var elements=el.find(opts.submenuSelector);}
elements.each(function(){$(this).attr('aria-hidden',!$(this).is(':visible'));});};$('h1',el).click(function(e){el.toggleClass('active');});links.on('focus hover',function(e){var activeEl=$(this).parent();var siblings=activeEl.siblings();activeEl.addClass(opts.focusClass);removeFocus(siblings.add(siblings.find('.'+opts.focusClass)));setAriaState(activeEl.parent().find(opts.submenuSelector));});$('a',el).last().keydown(function(e){if(e.keyCode==KEYCODES['tab']){removeFocus();setAriaState();}});el.on('mouseleave',function(){removeFocus();setAriaState();});links.keydown(function(e){var li=$(this).parent();var focusedIndex=links.index(this);if(e.keyCode==KEYCODES['escape']){removeFocus();setAriaState();e.preventDefault();}else if(e.keyCode==KEYCODES['left']){li.prev('li').children('a').focus();e.preventDefault();}else if(e.keyCode==KEYCODES['right']){li.next('li').children('a').focus();e.preventDefault();}else if(e.keyCode==KEYCODES['up']){var nextFocusedIndex=getFocusIndex('left',focusedIndex);if(nextFocusedIndex){links.eq(nextFocusedIndex).focus();}
e.preventDefault();}else if(e.keyCode==KEYCODES['down']){var nextFocusedIndex=getFocusIndex('right',focusedIndex);if(nextFocusedIndex){links.eq(nextFocusedIndex).focus();}
e.preventDefault();};});$(document).on('click',function(e){removeFocus();setAriaState();});$('li',el).each(function(){$(this).attr({'role':'menuitem','aria-haspopup':$(this).is(opts.navSelector)})
setAriaState($(this).children(opts.submenuSelector));});};return Plugin;});